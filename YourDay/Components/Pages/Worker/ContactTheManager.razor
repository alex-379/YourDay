@page "/contactTheManager"
@attribute [StreamRendering]

<GetClaims SendIsCompleted="b=>_isCompleted=b" SendRole="p=>_role=p"></GetClaims>

@if (_isCompleted && _role != RoleUI.Worker.ToString())
{
    <ReturnToStart></ReturnToStart>
}
else
{
    <PageTitle>ContactTheManager</PageTitle>

    <div>
        <h2 class="manager-h1">Здесь вы можете связаться с менеджером:</h2>
    </div>

    <table>
        <thead>
            @foreach (Column column in _table.Columns)
            {
            <th>
                    @column.LayoutHeader
            </th>
            }
        </thead>
        <tbody>
            @foreach (ManagerNameAndPhoneOutputModel manager in _models)
            {
                <tr>
                    @foreach (Column column in _table.Columns)
                    {
                        <td>
                            @typeof(ManagerNameAndPhoneOutputModel).GetProperty(column.Field).GetValue(manager)
                        </td>
                    }
                </tr>
            }
        </tbody>
    </table>
}

@code {
    private string? _role;

    private bool _isCompleted;

    private Tables _table;

    private IEnumerable<ManagerNameAndPhoneOutputModel> _models;

    private IManagerService _managers;

    public ContactTheManager()
    {
        _models = new List<ManagerNameAndPhoneOutputModel>();
        _managers = new ManagerService();
        _table = new Tables();
    }

    protected override async Task OnInitializedAsync()
    {
        _table.GetTableForPrintManagers();
        _models = await _managers.GetAllManagers();
    }
}